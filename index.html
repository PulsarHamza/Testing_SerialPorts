<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>XML File Generation and Download Example</title>
<style>
  .button {
    display: inline-block;
    padding: 10px 20px;
    background-color: #007bff;
    color: #fff;
    border: none;
    cursor: pointer;
    border-radius: 4px;
    text-decoration: none;
    text-align: center;
    font-size: 16px;
    margin-top: 20px;
  }
</style>
</head>
<body>
  <h2>Generate and Download XML File Example</h2>
  
  <button type="button" class="button" onclick="defaultXML_edit();">Generate and Download XML</button>

  <script>
    function defaultXML_edit() {
      // Simulate fetching XML data (you can replace with actual fetch call)
      const xmlText = `<?xml version="1.0" encoding="UTF-8"?>
        <Parameters>
          <Parameter>
            <Index>1</Index>
            <Value>10.12345</Value>
          </Parameter>
          <Parameter>
            <Index>2</Index>
            <Value>20.6789</Value>
          </Parameter>
        </Parameters>`;

      const parser = new DOMParser();
      const xmlDoc = parser.parseFromString(xmlText, "text/xml");

      const parametersList = xmlDoc.getElementsByTagName("Parameter");

      // Update parameters with new values (dummy example)
      for (let i = 0; i < parametersList.length; i++) {
        const parameterNode = parametersList[i];
        const value = Number(parameterNode.getElementsByTagName("Value")[0].textContent);
        parameterNode.getElementsByTagName("Value")[0].textContent = value.toFixed(3).toString();
      }

      // Convert XML back to text
      const serializer = new XMLSerializer();
      const updatedXmlText = serializer.serializeToString(xmlDoc);

      // Download the updated XML file
      downloadFile(updatedXmlText, "updated_xml.xml", "text/xml");
    }

    function downloadFile(data, filename, type) {
      const blob = new Blob([data], { type: type });
      const url = URL.createObjectURL(blob);

      // Create a link element
      const a = document.createElement("a");
      a.href = url;
      a.download = filename;
      a.textContent = "Download"; // Optional: Set text content for the link

      // Append the link to the body (or any desired element)
      document.body.appendChild(a);

      // Trigger a click event on the link to initiate download
      a.click();

      // Clean up: remove the link from the DOM
      document.body.removeChild(a);

      // Revoke the URL object to free up resources
      URL.revokeObjectURL(url);
    }
  </script>
</body>
</html>
