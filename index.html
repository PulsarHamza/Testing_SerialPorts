<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Fetch, Edit, Cache, and Download XML Example</title>
<style>
  .button {
    display: inline-block;
    padding: 10px 20px;
    background-color: #007bff;
    color: #fff;
    border: none;
    cursor: pointer;
    border-radius: 4px;
    text-decoration: none;
    text-align: center;
    font-size: 16px;
    margin-top: 20px;
  }
</style>
</head>
<body>
  <h2>Fetch, Edit, Cache, and Download XML Example</h2>
  
  <button type="button" class="button" onclick="fetchAndCacheXML();">Fetch and Cache XML</button>
  <button type="button" class="button" onclick="submitDownloadForm();">Download Edited XML</button>

  <!-- Hidden form for downloading XML -->
  <form id="downloadForm" method="post" style="display: none;">
    <input type="hidden" name="editedXML" id="editedXMLInput">
  </form>

  <script>
    // Function to fetch XML, edit it, and cache in local storage
    function fetchAndCacheXML() {
      const xmlUrl = './xml/sample.xml'; // Replace with your XML file URL

      fetch(xmlUrl)
        .then(response => {
          if (!response.ok) {
            throw new Error('Network response was not ok');
          }
          return response.text();
        })
        .then(xmlText => {
          // Edit the XML (add something random, for example)
          const editedXML = addRandomContent(xmlText);

          // Cache the edited XML in local storage
          localStorage.setItem('editedXML', editedXML);

          // Also update the hidden input field in the form
          document.getElementById('editedXMLInput').value = editedXML;

          // Optionally display or use the edited XML
          console.log('Edited XML:', editedXML);
        })
        .catch(error => {
          console.error('Error fetching XML:', error);
        });
    }

    // Function to simulate editing the XML (add something random)
    function addRandomContent(xmlText) {
      // Example: Add a random attribute to the root element
      const parser = new DOMParser();
      const xmlDoc = parser.parseFromString(xmlText, 'text/xml');
      const rootElement = xmlDoc.documentElement;

      // Example: Add a random attribute 'randomAttr'
      const randomValue = Math.random().toString(36).substring(7);
      rootElement.setAttribute('randomAttr', randomValue);

      // Serialize XML back to string
      const serializer = new XMLSerializer();
      const editedXML = serializer.serializeToString(xmlDoc);
      
      return editedXML;
    }

    // Function to submit the form and download the edited XML
    function submitDownloadForm() {
      const editedXML = localStorage.getItem('editedXML');

      if (editedXML) {
        // Update the hidden input field in the form
        document.getElementById('editedXMLInput').value = editedXML;

        // Submit the form
        const form = document.getElementById('downloadForm');
        form.action = URL.createObjectURL(new Blob([editedXML], { type: 'text/xml' }));
        form.method = 'GET';
        form.submit();
      } else {
        console.error('Edited XML not found in local storage.');
      }
    }
  </script>
</body>
</html>
